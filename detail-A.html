<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>A – Assignment 3</title>
<link rel="stylesheet" href="styles.css"/>
<style>
/* 仅此页微调：让 iframe 无滚动条，由脚本自动调高 */
.chart-slab{
  background:#fff; border:1px solid var(--line); border-radius:8px;
  box-shadow:0 2px 14px rgba(0,0,0,.07); padding:0; overflow:hidden;
  display:flex; flex-direction:column;
}
.chart-frame{
  width:100%;
  border:0; display:block; background:#fff; overflow:hidden;
  /* 不设固定高度/比例，由脚本根据内部 SVG 实际高度来设 */
  scrollbar-width:none;
}
.chart-frame::-webkit-scrollbar{ display:none; }

.detail-wrap{ align-items:start; }
.left-col,.right-col{ display:flex; flex-direction:column; }
.notes{
  flex-grow:1; display:flex; flex-direction:column;
  justify-content:space-between; height:100%;
}
</style>
</head>
<body>

<div class="detail-wrap">
  <!-- 左列 -->
  <section class="left-col">
    <div class="detail-title"><h2>A</h2></div>

    <!-- 图表 -->
    <div class="chart-slab">
      <iframe class="chart-frame" id="chartA" src="charts/A.html" title="Chart A" scrolling="no"></iframe>
    </div>

    <!-- 说明图片 + 文案（仅一张） -->
    <div class="figure" style="margin-top:18px;">
      <div class="img"><img src="figs/A-info.jpg" alt="说明图 A"/></div>
      <div class="caption">
        <strong>A:</strong><br/>
        Lack of lines, not parallel
      </div>
    </div>
  </section>

  <!-- 右列：Notes -->
<aside class="right-col">
  <div class="notes">
    <section class="notes">
      <h3>Notes / Grid Vectors with Arrowheads</h3>

      <h4>1) Canvas & Grid</h4>
      <p>
        Use <code>&lt;svg&gt;</code> as the canvas. Compute margins so an 11×4 grid
        (cell size 80 px) is centered within the SVG.
      </p>

      <h4>2) Key Points</h4>
      <p>
        Define four points in grid coordinates and convert them to pixel positions:<br/>
        eβ₂ (3, 3),  eβ₁ (6, 3),  eα₂ (5, 1),  eα₁ (8, 1).
      </p>

      <h4>3) Vectors</h4>
      <p>
        Draw six vectors in total:<br/>
        • 4 solid segments — β₂→α₂,  β₁→α₁,  β₂→β₁,  α₂→α₁.<br/>
        • 2 dashed arrows — α₁→β₂,  α₂→β₁.
      </p>

      <h4>4) Arrowheads</h4>
      <p>
        Use custom V-shaped markers whose apex is positioned at the end of the line.
        Set <code>refX = 12</code> and <code>refY = 6</code> so the arrow tip points exactly to the target point.
      </p>

      <h4>5) Animation</h4>
      <p>
        Apply the stroke-dash technique to animate line drawing.
        Start with a large dash offset and gradually reduce
        <code>stroke-dashoffset → 0</code> so each line is drawn from start to end.
      </p>

      <h4>6) Interaction</h4>
      <p>
        Add a wide invisible <code>.hit</code> stroke (~30 px) above each vector to capture hover events.
        When hovering, place a small dot at the closest point on the segment
        and show a tooltip with its label and coordinates.
      </p>

      <h4>7) Visual Consistency</h4>
      <p>
        Solid and dashed lines distinguish relation types.
        Arrowheads appear only on directed links.
        Grid and axes remain unchanged during animations for a stable visual layout.
      </p>
    </section>

    <div style="height:24px;"></div>
  </div>
</aside>
</div>

<script>
/* 接收 charts/A.html 发来的实际内容高度，并设置 iframe 高度 */
(function(){
  const frame = document.getElementById('chartA');

  function setH(h){
    if(!h) return;
    const H = Math.max(320, Math.min(1200, h)); // 限个合理范围
    if (Math.abs(frame.clientHeight - H) > 5) frame.style.height = H + 'px';
  }

  // 读取一次（同源可读时）
  function resizeByRead(){
    try{
      const doc = frame.contentDocument || frame.contentWindow.document;
      const h = Math.max(
        doc.body.scrollHeight, doc.documentElement.scrollHeight,
        doc.body.offsetHeight, doc.documentElement.offsetHeight
      );
      setH(h);
    }catch(e){}
  }

  frame.addEventListener('load', resizeByRead);
  window.addEventListener('message', (e)=>{
    if (e && e.data && e.data.__chartHeight != null) setH(e.data.__chartHeight);
  });
})();
</script>

</body>
</html>
