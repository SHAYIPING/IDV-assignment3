<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>B – Assignment 3</title>
<link rel="stylesheet" href="styles.css"/>
<style>
/* 仅此页微调布局 */
.chart-slab{
  background:#fff; border:1px solid var(--line); border-radius:8px;
  box-shadow:0 2px 14px rgba(0,0,0,.07);
  padding:0; overflow:hidden; display:flex; flex-direction:column;
}
/* 让 iframe 初始高度合理，随后由脚本自适应覆盖 */
.chart-frame{ width:100%; height:560px; border:0; display:block; background:#fff; overflow:hidden; }

/* Notes 与左侧底对齐 */
.detail-wrap{ align-items:start; }
.left-col,.right-col{ display:flex; flex-direction:column; }
.notes{ flex-grow:1; display:flex; flex-direction:column; justify-content:space-between; height:100%; }

/* 两张说明图并排 */
.figure-grid{ display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-top:18px; }
.figitem .img{ width:100%; background:#fff; border:1px solid var(--line); border-radius:6px; overflow:hidden; box-shadow:0 1px 8px rgba(0,0,0,.05); }
.figitem .img img{ width:100%; height:auto; display:block; }
.figitem .caption{ font-size:16px; color:#555; line-height:1.55; margin-top:8px; }
@media (max-width:800px){ .figure-grid{ grid-template-columns:1fr; } }
</style>
</head>
<body>

<div class="detail-wrap">
  <section class="left-col">
    <div class="detail-title"><h2>B</h2></div>

    <div class="chart-slab">
      <iframe class="chart-frame" id="chartB" src="charts/B.html" title="Chart B" scrolling="no"></iframe>
    </div>

    <div class="figure-grid">
      <div class="figitem">
        <div class="img"><img src="figs/B-info.jpg" alt="说明图 B"></div>
        <div class="caption"><strong>A：</strong>Wrong scale and position</div>
      </div>
      <div class="figitem">
        <div class="img"><img src="figs/B1-info.jpg" alt="说明图 B1"></div>
        <div class="caption"><strong>B：</strong>Give the coordinates of the points</div>
      </div>
    </div>
  </section>

 <aside class="right-col">
  <div class="notes">
    <section class="notes">
      <h3>Notes / Pixel-Placed Curves & Interaction</h3>

      <h4>1) Coordinate system & layout</h4>
      <p>
        Use a fixed, pixel-based layout: axes sit at exact x/y pixel positions.
        The left chart includes a base bar, a filled bar, a dashed-frame bar, and a short purple arrow.
      </p>

      <h4>2) Style tokens</h4>
      <ul>
        <li><code>.axis</code> — thick black axes.</li>
        <li><code>.tick</code> — short tick marks.</li>
        <li><code>.label</code> — text labels.</li>
        <li>Purple fill is semi-transparent.</li>
        <li>Dotted lines use <code>stroke-dasharray</code>.</li>
      </ul>

      <h4>3) Scales (if needed)</h4>
      <p>
        If values need mapping to pixels, define simple linear scales:
        x ∈ [0,1], y ∈ [0,40]. Otherwise, place shapes directly by pixel coordinates.
      </p>

      <h4>4) Axes & ticks</h4>
      <p>
        Draw horizontal and vertical axes first, then add short ticks and labels.
        Keep axis geometry fixed — no animations changing widths or dash patterns.
      </p>

      <h4>5) Bars & arrow on the left</h4>
      <p>
        Place the base bar, filled bar, and dashed-frame bar at fixed x positions.
        Add a short purple arrow pointing to the key value.
      </p>

      <h4>6) Curve data on the right</h4>
      <p>
        Collect measured anchor points (x, y). Convert them using scales if applied,
        or keep pixel positions directly.
      </p>

      <h4>7) Smooth path generation</h4>
      <p>
        Use Catmull–Rom to cubic Bézier conversion so the path passes smoothly through every anchor point.
      </p>

      <h4>8) Transitions</h4>
      <p>
        Apply opacity fade-in for the curves and a subtle slide-in for the short arrow.
        Do not alter dash patterns, line widths, or geometry during transitions.
      </p>

      <h4>9) Hover interaction</h4>
      <p>
        On the right chart, show a small dot at the nearest point and a tooltip displaying axis values
        (x in [0,1], y in [0,40]).
      </p>

      <h4>10) Visual integrity</h4>
      <p>
        Hover and animation effects should not disturb the original chart style —
        axes thickness, dash patterns, and layout remain unchanged.
      </p>
    </section>

    <div style="height:24px;"></div>
  </div>
</aside>
</div>

<!-- 自适应 iframe 高度：load + postMessage 双方案 -->
<script>
(function(){
  const frame = document.getElementById('chartB');

  // 方案A：同源直接读取子文档高度
  function resizeByRead(){
    try{
      const doc = frame.contentDocument || frame.contentWindow.document;
      const h = Math.max(
        doc.body.scrollHeight, doc.documentElement.scrollHeight,
        doc.body.offsetHeight, doc.documentElement.offsetHeight
      );
      if (h && Math.abs(frame.clientHeight - h) > 5) frame.style.height = h + 'px';
    }catch(e){ /* 跨域则忽略，走方案B */ }
  }

  frame.addEventListener('load', resizeByRead);

  // 方案B：子页通过 postMessage 主动汇报高度
  window.addEventListener('message', (e)=>{
    if (!e.data || e.data.__chartHeight == null) return;
    const H = Math.max(320, Math.min(1200, e.data.__chartHeight)); // 限定范围，避免异常
    frame.style.height = H + 'px';
  });
})();
</script>
</body>
</html>
